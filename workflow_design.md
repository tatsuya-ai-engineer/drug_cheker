# 薬剤併用禁忌チェックワークフロー設計

## 概要
このワークフローは、複数の医薬品添付文書PDFを分析し、薬剤間の併用禁忌や注意事項を自動的に抽出・分析するシステムです。Anthropic Claudeを利用して、PDFの内容から重要な情報を抽出し、併用に関する判断を行います。

## アーキテクチャ

```
┌────────────┐    ┌────────────┐    ┌────────────┐    ┌────────────┐
│  PDF URL   │    │  PDF変換   │    │ 情報抽出   │    │  分析結果  │
│   入力    │───▶│ マークダウン│───▶│  Claude   │───▶│  出力     │
└────────────┘    └────────────┘    └────────────┘    └────────────┘
                                          ▲                  │
                                          │                  ▼
                                    ┌────────────┐    ┌────────────┐
                                    │ フォローアップ│◀───│ チャット  │
                                    │   対応     │    │ インターフェース│
                                    └────────────┘    └────────────┘
```

## 処理ステップ

### 1. PDFのURL入力
- ユーザーが複数の医薬品添付文書のURLを入力
- 例: 処方薬A、処方薬B、処方薬Cの添付文書URL

### 2. PDFからマークダウンへの変換
- PDFファイルをダウンロード
- OCRまたはPDF解析ライブラリ（PyPDF2, pdfplumber等）を使用してテキスト抽出
- 抽出したテキストを構造化マークダウンに変換
  - 見出し構造を保持
  - 表や箇条書きの形式を可能な限り保持

### 3. 関連情報の抽出（Claude LLM）
- 各添付文書から以下のセクションを特定して抽出:
  - 「禁忌」セクション
  - 「相互作用」セクション
  - 「併用禁忌」「併用注意」に関する記述
  - 特定の患者（高齢者、腎機能障害患者等）への注意事項

### 4. 薬剤併用分析（Claude LLM）
- 抽出した情報から薬剤間の相互作用を分析
- 以下の分類で結果を整理:
  1. 併用禁忌（絶対に併用してはならない）
  2. 併用注意（慎重に併用する必要がある）
  3. 問題なし（明確な相互作用の記載がない）

### 5. 結果の出力
- マークダウン形式で分析結果を出力
- 構造化された情報として:
  - 要約と全体的な結論
  - 薬剤ごとの重要な抽出情報
  - 相互作用の詳細と根拠
  - 患者の状態を考慮した推奨事項

### 6. インタラクティブQA
- 分析結果に基づいてユーザーが追加質問可能
- 例えば:
  - 「この併用禁忌の理由は何ですか？」
  - 「代替薬として何が考えられますか？」
  - 「この患者の場合、特に注意すべき点は？」

## 技術的要件

### 必要なコンポーネント
1. **PDFプロセッサ**
   - PDF→テキスト変換モジュール
   - テキスト→マークダウン変換モジュール

2. **LLMインテグレーション**
   - Anthropic Claude API連携
   - プロンプトエンジニアリングフレームワーク

3. **ユーザーインターフェース**
   - URL入力フォーム
   - 結果表示画面
   - チャットインターフェース

### LLMプロンプト設計

#### 情報抽出プロンプト例
```
あなたは医薬品情報の専門家です。以下の添付文書から「禁忌」「相互作用」「併用禁忌」「併用注意」に関する情報を抽出してください。特に薬剤の相互作用に関する重要な情報に焦点を当ててください。

添付文書:
{markdown_content}

抽出すべき情報:
1. 禁忌となる患者の状態や疾患
2. 併用禁忌となる薬剤とその理由
3. 併用注意が必要な薬剤とその理由
4. 特定の患者（高齢者、腎機能障害患者等）への注意事項

抽出した情報は、項目ごとにマークダウン形式で整理してください。
```

#### 分析プロンプト例
```
あなたは薬剤師として、複数の薬剤の併用に関する分析を行います。以下の薬剤情報に基づいて、薬剤間の相互作用と併用の安全性を評価してください。

薬剤A情報:
{drug_a_extracted_info}

薬剤B情報:
{drug_b_extracted_info}

薬剤C情報:
{drug_c_extracted_info}

患者情報:
{patient_info}

分析すべき内容:
1. これらの薬剤間に併用禁忌はありますか？あれば詳細と理由を説明してください。
2. 併用注意はありますか？あれば詳細と対処法を説明してください。
3. 患者の状態を考慮した場合の特別な注意事項はありますか？
4. 総合的な判断として、これらの薬剤の併用は安全ですか？代替案がある場合は提案してください。

回答はマークダウン形式で、明確な構造と見出しを用いて提供してください。
```

## 実装方針

### 1. バックエンド
- Python FastAPIベースのRESTful API
- PDFプロセシングパイプライン
- Anthropic Claude APIとの連携モジュール
- 会話履歴管理システム

### 2. フロントエンド
- React/Vue.jsベースのSPA
- PDF URL入力フォーム
- 結果表示コンポーネント
- チャットインターフェース

### 3. データフロー
- PDF URL → PDF取得 → テキスト抽出 → マークダウン変換 → LLM抽出 → LLM分析 → 結果表示 → 対話型Q&A

## 将来的な拡張可能性
1. 薬剤DBとの連携による情報拡充
2. 患者情報の自動取り込み（電子カルテ連携）
3. 時系列での薬剤変更の追跡・分析
4. 医療従事者向けレポート機能の強化
5. 症例ベースの推奨システムの構築 